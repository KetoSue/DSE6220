this is really hard to do in spark